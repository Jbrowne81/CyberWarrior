## Automated ELK Stack Deployment

The files in this repository were used to configure the network depicted below:
https://github.com/Jbrowne81/CyberWarrior/blob/main/Diagrams/Asure%20Network%20Diagram_Final%20-%20Jeremy_Browne.pdf

These files have been tested and used to generate a live ELK deployment on Azure. They can be used to either recreate the entire deployment pictured above. Alternatively, portions of the ‘Asure Network Diagram - Jeremy_Browne.pdf’ file may be used to install only certain pieces of it, such as Filebeat.

Filebeats playbook file:
https://github.com/Jbrowne81/CyberWarrior/blob/main/Yaml_Files/filebeat-playbook.yml


This document contains the following details:
- Description of the Topology
- Access Policies
- ELK Configuration
- Beats in Use
- Machines Being Monitored
- How to Use the Ansible Build


### Description of the Topology
The main purpose of this network is to expose a load-balanced and monitored instance of DVWA, the D*mn Vulnerable Web Application

Load balancing ensures that the application will be highly available, in addition to restricting access to the network
-What aspect of security do load balancers protect? 
Load Balancers protect the system from DDoS attacks by shifting attack traffic. They distribute inbound network traffic evenly among the web servers and mitigates DoS attacks

-What is the advantage of a jump box?
To give access to the user from a single node that can be secured and monitored. This server sits in front of other machines (Load Balancer, Web Servers, ELK Server) which are not directly exposed to the public internet
It controls access to the other machines by allowing connections from specific IP addresses and forwarding network traffic to our other VMs








Integrating an ELK server allows users to easily monitor the vulnerable Web VMs for changes to the data and system logs
-What does Filebeat watch for?
Collects data about the file system, enables analysts to monitor files for suspicious changes.
Use Filebeat to collect, parse, and visualize ELK logs in a single command. This will help better track our organizational goals. Specifically, we will monitor the Apache server and MySQL database logs generated by the web servers

-What does Metricbeat record?
Collects / records web server metrics, such as uptime and CPU usage. Displays data in graph / charts
     -CPU usage: The heavier the load on a machine's CPU, the more likely it is to fail. Receive alerts when usage is too high
    - Uptime: Measures how long a machine has been on. Servers are generally expected to be available for a certain percentage of the time. Ensure the web servers meet service-level agreement (SLAs) standards

The configuration details of each machine may be found below.
_Note: Use the [Markdown Table Generator](http://www.tablesgenerator.com/markdown_tables) to add/remove values from the table_.

| Name		| Function                      | Private IP Address	| Public IP      | Operating System		|
|---------------|-------------------------------|-----------------------|---------------------|------------------------ |
| Jump Box	| Gateway			| 10.0.0.1		| 20.83.225.130  | Linux Ubuntu			|
| Load Balancer	| Distribute Network Traffic	|		  	| 13.66.246.231  | Linux Ubuntu			|
| Web-1		| store, process and deliver	| 10.0.0.10	  	| 13.66.246.231  | Linux Ubuntu			|
                                web pages                             
| Web-2		| store, process and deliver	| 10.0.0.11	  	| 13.66.246.231  | Linux Ubuntu			|
                                web pages                             
| Elk Server	| Logs Files, Metric		| 10.1.0.4	  	| 20.62.88.5     | Linux Ubuntu			|
		   Monitoring 

### Access Policies
The machines on the internal network are not exposed to the public Internet

Only the JumpBox machine can accept connections from the Internet. Access to this machine is only allowed from the following IP addresses:

Add whitelisted IP addresses:
Home Client Workstation
Public IP: 68.2.47.114

Machines within the network can only be accessed by the JumpBox Server
Which machine did you allow to access your ELK VM?
JumpBox Server

What is its IP address?
Public IP: 20.83.225.130
Private IP: 10.0.0.15


A summary of the access policies in place can be found in the table below.

| Name		| Publicly Accessible   |  Allowed IP Addresses                                 |
|---------------|--------------------------- |--------------------------------------------------|
| Jump Box	| Yes			| Home Public IP (SSH) 68.2.47.114			|
| Load Balancer	| Yes			| Home Public  (68.2.47.114)				|
| Web-1		| No			| Home Public (68.2.47.114), Jump Box (10.0.0.15) 	|
| Web-2		| No			| Home Public (68.2.47.114), Jump Box (10.0.0.15) 	|
| ELK Server	| No			| Home Public (68.2.47.114), Jump Box (10.0.0.15)	|


### Elk Configuration
Ansible was used to automate configuration of the ELK machine. No configuration was performed manually, which is advantageous because...
- What is the main advantage of automating configuration with Ansible?
-Simple to Setup and Use
-Repeatability
-Flexibility

The playbook implements the following tasks:
- In 3-5 bullets, explain the steps of the ELK installation play. E.g., install Docker; download image; etc._

1. Virtual Hardware Setup Process:
Create New ELK Server Virtual Machine
-Log into Asure website (https://portal.azure.com/) with Username and Password
-‘Create New’ ELK Server VM in Asure with the following criteria:
    -Subscription: Azure subscription 1
    -Resource Group: NetworkWatcherRG
    -Virtual Machine Name: ELKServer
    -Region: East US 2 (Zone 1)
    -Availability Options: Availability Zone
    -Availability Zone: 1
    -Image: Ubuntu Server 20.04 LTS - Gen 1
    -Size: Standard D2s v3 (2 vcpus, 8 GiB memory)
    -Authentication Type: SSH Public Key
    -Username: azadmin
    -SSH public key source: Select ‘Use existing public key’
    - Enter SSH Public Key:
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCaCP2uNoG5LxdRHg74ZXiy4U5OFtUnts3JbqpPTA1ENKuyyuXNdSDHYgvMyZXA5xCQY4G0EZrXtPzraxGt4R9mlTT3SOCO1AwRZX7IHa3gLqPtoU5cPVZDQlSeQg5N9ZVBDm2z9FiRHRMZ724eoF7yoOeHQH6skBRv7jMcTdnetXvWYKvYD+6c9z1l8jeGYQJI8AHH7w4YK7xB5rBO+LQMB0TDe4Pu8Oaan05oJiDKcDEGCjYeconxfu8xI+DUvdAPgmlW+quwdYZyLN6jlIPbr2Rkstu83o4+lyZFWgXtzjkHsr7fj2GGxVZw4vkh8dgqG3CQzDlmnccKy/IMlDWX root@3ca40a6a9d6b
    -Public inbound ports: Select ‘Allow selected ports’
    -Select inbound ports: Select ‘SSH (22)
    -Click ‘Review and Create’

2. Create Docker Container on ELK Server
    a - Edit Ansible host file (command: nano hosts).  Edit the hosts.yml file and add the following:
[elk]
10.1.0.4 ansible_python_interpreter=/usr/bin/python3

    b - Create a playbook (command: nano install-elk.yml) that installs a Docker container and configures it (file: install-elk.yml)
Elk Server Install file (cd /etc/ansible/install-elk.yml)
GitHub url: https://github.com/Jbrowne81/CyberWarrior/blob/main/Yaml_Files/install-elk.yml

    c - Run install-elk.yml, with command: ansible-playbook install-elk.yml

3. Restrict access to the ELK VM
On the Asure Website, Click on Network Security Group of ELKServer-nsg, click on ‘Inbound Security Rules’, then ‘Add’ 3 rules
    a - Restrict ALL Inbound Network Traffic

    b - Allow Inbound Network Traffic from Public IP Address

    c - Allow Inbound Network Traffic from Jumpbox

4. Add New Elk Server to Virtual Network: 
Red_Team_VM2 (Peered to Red_Team_VM)

5. Add New Elk Server to Network Security Group:
ELKServer-nsg

6. install-elk.yml breakdown
     -Installation of docker container
     -Install Python 3 – automates and monitors operating system
     -Increase and use additional virtual memory
     -Download and launch Elk container (sebp/elk:761)
     -Elk container runs on ports 5601, 9200, and 5044 


The following screenshot displays the result of running `docker ps` after successfully configuring the ELK instance

Update the path with the name of your screenshot of docker ps 
GitHub url: https://github.com/Jbrowne81/CyberWarrior/blob/main/Screenshots/ELK%20Server%20-%20docker%20ps%20command%20(screenshot).pdf


### Target Machines & Beats
This ELK server is configured to monitor the following machines:
List the IP addresses of the machines you are monitoring
Web-1 Server: 10.0.0.10 
Web-2 Server: 10.0.0.11

We have installed the following Beats on these machines:
Specify which Beats you successfully installed
Filebeats and Metricbeats

These Beats allow us to collect the following information from each machine:
In 1-2 sentences, explain what kind of data each beat collects, and provide 1 example of what you expect to see. E.g., `Winlogbeat` collects Windows logs, which we use to track user logon events, etc

Elk Server Data Collection Tool - Filebeats
Description / Functionality:
Collects data about the file system, enables analysts to monitor files for suspicious changes.
Use Filebeat to collect, parse, and visualize ELK logs in a single command. This will help us better track our organizational goals. Specifically, we will monitor the Apache server and MySQL database logs generated by the web servers

Filebeats Example: Log Files – Destination Ports being accessed, from specific countries, etc.

Elk Server Data Collection Tool - Metricbeats
Description / Functionality
Collects machine metrics, such as uptime and CPU usage, displays data in graph / charts
     -CPU usage: The heavier the load on a machine's CPU, the more likely it is to fail. Analysts often receive alerts when usage is too high
    - Uptime: Measures how long a machine has been on. Servers are generally expected to be available for a certain percentage of the time. Ensure the web servers meet service-level agreements (SLAs)

Metricbeats Example: CPU Usage, Memory Usage, Uptime



### Using the Elk Server Playbook
In order to use the playbook, you will need to have an Ansible control node already configured. Assuming you have such a control node provisioned: 

SSH into the control node and follow the steps below:
- Copy the hosts and  install-elk.yml files to the JumpBox Server (Ansible Container): Folder etc/Ansible
- Update the hosts file to include:
[elk]
10.1.0.4 ansible_python_interpreter=/usr/bin/python3

- Run the playbook (ansible-playbook install-elk.yml), and navigate to http://20.62.88.5:5601/app/kibana to check that the installation worked as expected


Answer the following questions to fill in the blanks:
- Which file is the playbook? 
install-elk.yml

- Where do you copy it?
Copy onto the JumpBox Server, Ansible Container, in Folder ‘etc/Ansible’

- Which file do you update to make Ansible run the playbook on a specific machine? 
hosts.yml files

Edit and add the following
[webservers]
10.0.0.10 ansible_python_interpreter=/usr/bin/python3
10.0.0.11 ansible_python_interpreter=/usr/bin/python3

[elk]
10.1.0.4 ansible_python_interpreter=/usr/bin/python3


- How do I specify which machine to install the ELK server on versus which to install Filebeat on?_
From JumpBox Ansible Container, Run ‘ansible-playbook install-elk.yml’ to Install ELK server
GitHub url: https://github.com/Jbrowne81/CyberWarrior/blob/main/Yaml_Files/install-elk.yml

From JumpBox Ansible Container, Run ‘ansible-playbook filebeats-playbook.yml’ to Install Filebeats on Web Servers
GitHub url: https://github.com/Jbrowne81/CyberWarrior/blob/main/Yaml_Files/filebeat-playbook.yml

- Which URL do you navigate to in order to check that the ELK server is running?
http://20.62.88.5:5601/app/kibana
